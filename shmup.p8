pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--init file
function _init()
	cls(0)
	state = 0
end

function startgame()
	x=63
	y=100
	vel_x=0
	vel_y=0
	speed=3
	
	score = 0
	
	flame = 4
	shipspr=2
	muzzle=0
	
	lives = 3
	
	maxlives= 3 
	bombs = 3
	
	
	enemies = {}
	add(enemies,add_enemy())
	
	plbullets = {}
	stars = starfield()
end



function _update()
	if state==0 then
		state=0
		if(btnp(4) or btnp(5)) then
			startgame()
			state=1
		end
	elseif state==1 then
		update_game()
	end
end

function _draw()
	print(state)
	if state==0 then
		cls(12)
		print("shmup game",45,10,0)
		print("in pico 8",50,30,0)
		print("press button to begin",30,50)
	elseif state==1 then
				draw_game()
	elseif state==2 then
		cls(8)
		print("dead",0,0,4)
	end
end


-->8
--update
function update_game()

	if(lives==0) then 
	 
		state=2
	end

	vel_x=0
	vel_y=0
	if(btn(0)) vel_x=-speed
	if(btn(1)) vel_x=speed
	if(btn(2)) vel_y=-speed
	if(btn(3)) vel_y=speed
	if(btnp(5)) then 
		boolet(x,y)	
	end
	if(btnp(4) and bombs>0) then
		bombs=bombs-1
		stars= {}
	end
	
	x=x+vel_x
	y=y+vel_y
	shipspr = 2
	if(vel_x>0) shipspr = 3
	if(vel_x<0) shipspr = 1
	
	if(x>128) x=0
	if(x<0) x=128
	if(y>128) y=0
	if(y<0) y=128
	
	flame+=1
	if(flame == 8) flame = 4
	
	
end

-->8
--render

function draw_game()
	
	--clear screen
	cls(0)
					hit_box()
 --draw ship
	spr(shipspr,x,y)
	
	--draw flame
	spr(flame,x,y+8)
	foreach(stars,render_starfield)
	--draw bullets
	foreach(plbullets,draw_bullet)
	foreach(enemies,render_enemies)
	--foreach(plbullets,draw_bullet)
	
	
	
	if(muzzle > 0) then
		circfill(x+2,y-1,muzzle,7)
		circfill(x+5,y-1,muzzle,7)
		muzzle=muzzle -1
	end
	
--ui
	print("score:"..score,50,0,12)
	
	for i=1,maxlives do
		if (lives>=i) then
			spr(49,0+i*9,0)
		end
		if (lives<i) then
			spr(50,0+i*9,0)
		end
	end
	
	for i=1,bombs do
			spr(51,128-i*9)
	end
	
	--debug
	--print(x.." "..y)
	--print(frame)
	--print(count(plbullets))
end






-->8
--everything to do with bullets
--also some other elements
function draw_bullet(o)
	--print("hello")
	
	if(o.y<-5) then
		del(plbullets,o)
		--sfx(1)
	end
	
	o.y=o.y-10
	
	spr(o.bspr,o.x,o.y)
	if(o.bspr != 18) o.bspr+=1
end

function boolet(pl_x,pl_y)
	local bullet= {
	x = pl_x,
	y = pl_y-2,
	bspr = 16
	}
	sfx(0)
	muzzle=4
	add(plbullets,bullet)
end


function starfield()
	local star_list= {}
	for i=1,100 do
		add(star_list,createstar())
	end
	return star_list
end

function createstar()
	local star = {
		x = flr(rnd(128)),
		y = flr(rnd(128)),
		vely = (flr(rnd(4))+1)
	}
	if(star.vely==4) then
		star.col = 12
	elseif(star.vely<4) then 
		star.col = 7
	elseif(star.vely==1) then
	 star.col = 13
	end
	return star
end


function render_starfield(o)
	o.y=(o.y+o.vely)
	pset(o.x,o.y,o.col)
	if(o.vely==4) then
		line(o.x,o.y-6,o.x,o.y-1,6)
	end
	
	
	if(o.y>=128) then 
		
		
		del(stars,o)
		local star =createstar()
		star.y=0
		add(stars,star)
	end
	
	
end

function render_enemies(o)
	o.x=((o.x+o.vel_x))%150
	
	
	if(o.x<10 or o.x>120) o.vel_x=-o.vel_x
	spr(21,o.x,o.y)
end


function add_enemy()
	local enemy = {
		x = rnd(110)+10, 
		y = rnd(50)+10, 
		sp = 21,
		hp = 3,
		vel_x= flr(rnd(3))+2
		
		}
		if(flr(rnd(2))>1) enemy.vel_x=-enemy.vel_x
	return enemy
end


function hit_box()
	for i in all(plbullets) do
			for e in all(enemies) do
				--print(e.x.." "..i.x.." "..e.x+7,50,50)
				if((e.y-8<=i.y) and (e.y+8>=i.y) and(e.x-8<=i.x) and (e.x+8>=i.x)) then
				 del(plbullets,i)
				 sfx(1)
				 e.hp=e.hp-1
				 if (e.hp<=0) then
				  del(enemies,e)
				  add(enemies,add_enemy())
				 end
				end
			end
	end
end






__gfx__
00000000033030000030030000030330008aa900008aa8000089a800009aa800008aa90000000000000000000000000000000000000000000000000000000000
000000000b99b00000b99b00000b99b0009a8000009aa900009a9900009a9900009a8a8000000000000000000000000000000000000000000000000000000000
007007000baabb0000baab0000bbaab0088a99900099a8000099a8000099a800088a9a9000000000000000000000000000000000000000000000000000000000
000770000111330001311310003311100000090000089a0000089a0000889a000000890000000000000000000000000000000000000000000000000000000000
00077000b1113310b131131b0133111b000000000008880000888800008880000000000000000000000000000000000000000000000000000000000000000000
0070070039a931b03b1991b30b139a93000000000000000000088000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b33b3003b33b3003b33b30000000000000000000008800000000000000000000000000000000000000000000000000000000000000000000000000
00000000003330000003300000033300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009900009999990000000000000000000bbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000099aa99099aaaa99000000000000000000bbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000
009aa90009a77a909aa77aa9000000000000000000bbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000
09a77a909a7777999a7777a90000000000000000066bb66000000000000000000000000000000000000000000000000000000000000000000000000000000000
09a77a909a7777999a7777a900000000000000005566665500000000000000000000000000000000000000000000000000000000000000000000000000000000
009aa90009a77a909aa77aa900000000000000005363363500000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000099aa99099aaaa9900000000000000005563365500000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000990000999999000000000000000000555555000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00022000088008800880088000000090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002882008888888880088008001199a9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00288200888888888000000801111a90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02e88e208888888880000008016d1d10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2e87c8e2088888800800008001d66dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
288118820088880000800800011d6d10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
028dd820000880000008800000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00299200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
000000000088008800088008800088008800000000000000000cc00cc00cc0ccc0ccc00000ccc000000000000000000000000000000000000000900000000900
00000000088888888088888888088888888000000000000000c000c000c0c0c0c0c0000c00c0c000000000000000000000000000000000001199a90001199a90
00000000088888888088888888088888888000000000000000ccc0c000c0c0cc00cc000000c0c00000000000000000000000000000000001111a90001111a900
0000000008888888808888888808888888800000000000000000c0c000c0c0c0c0c0000c00c0c000000000000000000000000000000000016d1d100016d1d100
00000000008888880008888880008888880000000000000000cc000cc0cc00c0c0ccc00000ccc00000000000000000000000000000000001d66dd0001d66dd00
00000000000888800000888800000888800000000000000000000000000000000000000000000000000000000000000000000000000000011d6d100011d6d100
00000000000088000000088000000088000000000000000000000000000000000000000000000000000000000000000000000000000000001111000001111000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000009999990000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000099aaaa99000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000009aa77aa9000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000009a7777a9000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000009a7777a9000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000009aa77aa9000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000099aaaa99000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000009999990000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000bbbb0000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000bbbb0000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000bbbb0000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000066bb66000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000005566665500000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000005363363500000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000005563365500000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000555555000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000c000c0c00000c000ccc00000ccc0cc000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000c000c0c00000c00000c0000000c00c000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000ccc0ccc00000ccc00cc0000000c00c000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000c0c000c00000c0c000c0000000c00c000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000ccc000c00000ccc0ccc0000000c0ccc00000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000099000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000099aa990000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000009a77a90000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000009a777799000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000009a777799000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000009a77a90000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000099aa990000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000099000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000077777777000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000777777777700000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000777777777700000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000777777777700000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000077777777000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000001311310000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000b131131b000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000003b1991b3000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000003b33b30000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000033000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000008aa900000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000009a8000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000088a9990000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000900000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
000100001d5100e5100d510077100671005710047100e5100e510095100851007510065100651006510055100350000500005000d4000d400340000c4000b4000b40006000060000600005000050000400004000
000100001361017610126101462018610046100461004610076100a610096100a6000a60000600036000460003600036000360003600036000360001400014000040000400004000040000400004000140001400
